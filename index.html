<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trapside</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
    --bg: #05060a;
    --glass: rgba(255, 255, 255, 0.05);
    --glass-border: rgba(255, 255, 255, 0.08);
    --accent: #00b4ff;
    --bot: rgba(0, 180, 255, 0.15);
    --user: rgba(255, 255, 255, 0.12);
    --code-bg: #0d1117;
    --code-border: #1f2937;
}

body {
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: white;
    font-family: "Inter", sans-serif;
    overflow: hidden;
}

.container {
    height: 100vh;
    display: flex;
    flex-direction: column;
}

.header {
    padding: 20px;
    font-size: 28px;
    font-weight: 600;
    letter-spacing: -1px;
    color: var(--accent);
    user-select: none;
    text-shadow: 0 0 8px rgba(0,180,255,0.5);
}

.view {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    padding-bottom: 140px;
}

.message {
    max-width: 85%;
    padding: 16px 20px 40px 20px;
    border-radius: 16px;
    margin: 16px 0;
    position: relative;
    line-height: 1.6;
    white-space: pre-wrap;
}

.user-msg {
    background: var(--user);
    align-self: flex-end;
    margin-left: auto;
    border-bottom-right-radius: 4px;
}

.bot-msg {
    background: var(--bot);
    align-self: flex-start;
    border-bottom-left-radius: 4px;
}

/* CODE BLOCKS */
.code-block-container {
    background: var(--code-bg);
    border: 1px solid var(--code-border);
    border-radius: 16px;
    margin: 16px 0;
    padding: 16px;
    position: relative;
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    color: #e3e6eb;
    box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    cursor: pointer;
    transition: 0.2s;
    overflow-x: auto;
    white-space: pre-wrap;
}

.copy-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    cursor: pointer;
}

.input-area {
    position: absolute;
    bottom: 30px;
    left: 0;
    right: 0;
    padding: 0 20px;
    display: flex;
    justify-content: center;
}

.input-container {
    display: flex;
    gap: 12px;
    max-width: 800px;
    width: 100%;
    padding: 10px 14px;
    border-radius: 40px;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(30px);
}

.input-field {
    flex: 1;
    background: transparent;
    border: none;
    padding: 10px 15px;
    color: white;
    font-size: 16px;
    outline: none;
    resize: none;
    max-height: 120px;
    min-height: 24px;
    line-height: 1.5;
}

.send-btn {
    background: var(--accent);
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    color: white;
    cursor: pointer;
    transition: 0.3s;
}

/* MOBILE */
@media (max-width: 768px) {
    .header { padding: 16px; font-size: 24px; }
    .message { max-width: 90%; font-size: 14px; }
    .input-container { padding: 8px 12px; }
}
</style>
</head>

<body>
<div class="container">
    <div class="header">Trapside</div>

    <div class="view" id="scroll-area">
        <div id="chat-box"></div>
    </div>

    <div class="input-area">
        <div class="input-container">
            <textarea id="user-input" class="input-field" placeholder="Ask anything..." rows="1"></textarea>
            <button id="send-btn" class="send-btn"><i class="fas fa-arrow-up"></i></button>
        </div>
    </div>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");
const scrollArea = document.getElementById("scroll-area");

let controller = null;

function appendMessage(sender, text, isCode = false) {
    const msg = document.createElement("div");
    msg.className = `message ${sender}-msg`;

    if (isCode) {
        msg.innerHTML = `
            <div class="code-block-container">
                <button class="copy-btn"><i class="fas fa-copy"></i></button>
                <pre><code>${escapeHtml(text)}</code></pre>
            </div>
        `;
        setupCopyButtons();
    } else {
        msg.innerText = text;
    }

    chatBox.appendChild(msg);
    scrollArea.scrollTop = scrollArea.scrollHeight;
}

function escapeHtml(text) {
    return text.replace(/&/g, "&amp;")
               .replace(/</g, "&lt;")
               .replace(/>/g, "&gt;")
               .replace(/"/g, "&quot;");
}

function setupCopyButtons() {
    document.querySelectorAll(".copy-btn").forEach(btn => {
        btn.onclick = () => {
            const codeText = btn.parentElement.querySelector("code").innerText;
            navigator.clipboard.writeText(codeText);
            btn.innerHTML = "<i class='fas fa-check'></i>";
            setTimeout(() => btn.innerHTML = "<i class='fas fa-copy'></i>", 1500);
        };
    });
}

async function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;

    appendMessage("user", text);
    userInput.value = "";
    userInput.style.height = "24px";
    sendBtn.disabled = true;

    controller = new AbortController();
    appendMessage("bot", "Thinking...");

    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer YOUR_API_KEY"
            },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [{ role: "user", content: text }],
                stream: true
            }),
            signal: controller.signal
        });

        const reader = response.body.getReader();
        let botMsg = document.querySelector(".bot-msg:last-child");
        botMsg.innerText = "";
        const decoder = new TextDecoder();
        let buffer = "";

        while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            buffer += decoder.decode(value, { stream: true });
            const parts = buffer.split("\n\n");
            buffer = parts.pop();

            for (const part of parts) {
                if (!part.startsWith("data: ")) continue;
                if (part.includes("[DONE]")) continue;

                const json = JSON.parse(part.replace("data: ", ""));
                const delta = json.choices[0].delta;
                if (delta.content) botMsg.innerText += delta.content;
            }
            scrollArea.scrollTop = scrollArea.scrollHeight;
        }
    } catch (err) {
        appendMessage("bot", "âŒ Request cancelled or failed.");
    }

    sendBtn.disabled = false;
}

sendBtn.onclick = sendMessage;

userInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

userInput.addEventListener("input", () => {
    userInput.style.height = "24px";
    userInput.style.height = Math.min(userInput.scrollHeight, 140) + "px";
});
</script>

</body>
</html>
